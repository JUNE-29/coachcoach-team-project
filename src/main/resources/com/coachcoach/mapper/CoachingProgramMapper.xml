<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.coachcoach.dao.CoachingProgram">

  <resultMap type="CoachingProgram" id="CoachingProgramMap">
    <id column="program_no"  property="no"/>
    <result column="coach_no"       property="coachNo"/>
    <result column="name"       property="name"/>
    <result column="introduce"  property="introduce"/>
    <result column="fee"    property="fee"/>
    <result column="coaching_type" property="coachingType"/>
    
    <collection property="coachingProgramTags" ofType="Integer">
      <id column="tag_no"   property="tagNo"/>
      <result column="program_no"  property="programNo"/>
    </collection>
  </resultMap>
  
  
   <insert id="insert" parameterType="CoachingProgram"
   useGeneratedKeys="true" keyColumn="program_no" keyProperty="no">
    insert into coaching_programs(
     coach_no,
     name,
     introduce,
     fee,
     coaching_type
    ) values(
      #{coachNo},
      #{introduce},
      #{fee},      
      #{coachingType},
    )
  </insert>
  
  <select id="findAllByCoachNo" resultMap="CoachingProgramMap" parameterType="int">
    select 
      c.program_no,
      c.coach_no,
      c.name,
      c.introduce,
      c.fee,
      w.name
    from 
     coaching_program_tags ct
      join coaching_programs c on c.program_no=ct.program_no
      join workout_tags w on w.tag_no=ct.tag_no
    where 
      c.coach_no=#{coachNo}
  </select>


  <update id="update" parameterType="CoachingProgram">
    update coaching_programs
    <set>
      <if test="coachNo > 0">coach_no=#{coachNo},</if> 
      <if test="name != null and name != ''">name=#{name},</if>             
      <if test="introduce != null and introduce != ''">introduce=#{introduce},</if> 
      <if test="fee > 0">fee=#{fee},</if>       
      <if test="coachingType != null and coachingType != ''">coaching_type=#{coachingType},</if>
    </set>
      where 
        coach_no=#{coachNo}
  </update>
  
   <delete id="delete" parameterType="int">
    delete from coaching_programs
    where program_no=#{no}
  </delete>
  
  
   <select id="findByKeyword" 
    resultMap="CoachingProgramMap" 
    parameterType="string">
    <bind name="keywordPattern" value="'%' + _parameter + '%'"/>
    select 
      c.name,
      cp.name,
      cp.introduce,
      cp.fee
    from 
      coaching_programs cp 
      join coaches c on cp.coach_no=c.coach_no
    where 
      c.name like #{keywordPattern}
      cp.name like #{keywordPattern}      
  </select>
  
  
</mapper>







